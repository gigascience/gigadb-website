#!/usr/bin/env bash

# load the library of configuration function
source ../../configurator/src/dotfiles.sh

# bail out upon error
set -e

# bail out if an unset variable is used
set -u

# set up the application source
appSource=.

set -a
makeDotEnv $appSource
set +a

# generate config for Yii2 config files: SOURCE TARGET VARS
# If we are on staging environment override variable name with their remote environment counterpart
echo "Current environment: $GIGADB_ENV"

set -a

cp "${appSource}/config-sources/rclone.conf.dist" "${appSource}/config/rclone.conf"

curl -s --header "PRIVATE-TOKEN: $GITLAB_PRIVATE_TOKEN" "$MISC_VARIABLES_URL/id_rsa_aws_hk_gigadb_pem" | jq -r .value > ~/.ssh/id-rsa-aws-hk-gigadb.pem