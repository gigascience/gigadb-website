version: '3.7'

services:

  production_web:
    environment:
      YII_PATH: ${YII_PATH}
      YII2_PATH: ${YII2_PATH}
    build:
      context: ..
      dockerfile: packaging/Web-Dockerfile
      args:
        - NGINX_VERSION=${NGINX_VERSION}
        - GIGADB_ENV=${GIGADB_ENV}
        - FIX_SITE_CONFIGS=true
    volumes:
      - ../../assets:/var/www/assets

  production_app:
    build:
      context: ../..
      dockerfile: ops/packaging/Production-Dockerfile
      args:
        - TARGET_PHP_VERSION=${PHP_VERSION}
        - INSTALL_OPCACHE=true
        - INSTALL_INTL=true
        - INSTALL_COMPOSER=false
        - INSTALL_TIDEWAYS_XHPROF=false
        - INSTALL_LIBSODIUM=true
        - INSTALL_APCU=true
    volumes:
      - ../../assets:/var/www/assets

  production_fuw-admin:
    build:
      context: ../../fuw/app/backend
      dockerfile: Production-Dockerfile
      args:
        - "IMAGE_NAME=registry.gitlab.com/$CI_PROJECT_PATH/fuw-admin"
        - PHP_BASE_IMAGE_VERSION=7.2-fpm-stretch
        - APP_PORT=9002
        - APP_ROOT_DIR=/var/fuw/backend/web/
        - INSTALL_OPCACHE=true
        - INSTALL_INTL=true
        - INSTALL_COMPOSER=true
        - INSTALL_TIDEWAYS_XHPROF=false
        - INSTALL_LIBSODIUM=false
        - INSTALL_APCU=true
        - INSTALL_DOCKER_API_ACCESS=false


  production_config:
    build:
      context: ../..
      dockerfile: ops/packaging/Config-Dockerfile